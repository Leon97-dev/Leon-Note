// ìŠ¤í‚¤ë§ˆ ëª¨ë¸ ì˜ˆì‹œ 
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/**
 * ì´ì»¤ë¨¸ìŠ¤ DB êµ¬ì¡°
 * ğŸ‘‰ User â†” Order = 1:N
 * ğŸ‘‰ User â†” UserPreference = 1:1
 * ğŸ‘‰ User â†” Product = N:M (ì°œëª©ë¡)
 * ğŸ‘‰ Order â†” Product = N:M (OrderItem ì¡°ì¸ í…Œì´ë¸”)
 */

// ============================================
// User (ìœ ì €)
// ============================================
model User {
  id        Int     @id @default(autoincrement())
  email     String  @unique
  firstName String  @map("furst_name")
  lastName  String  @map("last_name")
  address   String?

  // ê´€ê³„
  orders         Order[]
  userPreference UserPreference?
  savedProducts  Product[]

  // íƒ€ì„ìŠ¤íƒ¬í”„
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

// ============================================
// Product (ìƒí’ˆ)
// ============================================
model Product {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  category    Category // enum
  price       Float
  stock       Int

  // ê´€ê³„
  orderItems OrderItem[]
  savedUsers User[]

  // íƒ€ì„ìŠ¤íƒ¬í”„
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

// ============================================
// UserPreference (ìœ ì € ì„ í˜¸)
// ============================================
model UserPreference {
  id           Int     @id @default(autoincrement())
  receiveEmail Boolean @map("receive_email") // true/false

  // ê´€ê³„
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int  @unique

  // íƒ€ì„ìŠ¤íƒ¬í”„
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

// ============================================
// Order (ì£¼ë¬¸)
// ============================================
model Order {
  id     Int         @id @default(autoincrement())
  status OrderStatus @default(PENDING) // enum

  // ê´€ê³„
  user       User?       @relation(fields: [userId], references: [id], onDelete: SetNull)
  userId     Int?
  orderItems OrderItem[]

  // íƒ€ì„ìŠ¤íƒ¬í”„
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

// ============================================
// OrderItem (ì£¼ë¬¸ ìƒí’ˆ)
// ============================================
model OrderItem {
  id        Int   @id @default(autoincrement())
  unitPrice Float @map("unit_price")
  quantity  Int

  // ê´€ê³„
  Product   Product @relation(fields: [productId], references: [id])
  productId Int
  Order     Order   @relation(fields: [orderId], references: [id])
  orderId   Int

  // íƒ€ì„ìŠ¤íƒ¬í”„
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

// ============================================
// Enum
// ============================================
enum Category {
  FASHION
  BEAUTY
  SPORTS
  ELECTRONICS
  HOME_INTERIOR
  HOUSEHOLD_SUPPLIES
  KITCHENWARE
}

enum OrderStatus {
  PENDING
  COMPLETE
}
