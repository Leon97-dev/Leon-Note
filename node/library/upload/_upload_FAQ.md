# multer vs sharp

_multer는 “파일을 받아서 저장하는 역할”만 한다._
multer가 하는 일은 딱 2개다.

- 폼데이터(multipart/form-data) 파싱
- 파일을 디스크/메모리에 저장

거기에 옵션으로,

- 확장자 검사
- 파일 크기 제한
- 업로드 위치 지정
- 파일 이름 커스텀

여기까지다.
즉, multer는 ‘이미지 보정’, ‘압축’, ‘리사이즈’, ‘변환’을 전혀 못 한다.

_sharp는 “이미지 자체를 가공하는 도구”다._
sharp는 이미지에 대해 이런 작업을 한다.

- 크기 변경 (resize)
- 용량 압축 (quality)
- 포맷 변환 (jpg → webp)
- 썸네일 생성
- 메타데이터 제거
- 배경 제거/자르기 등 일부 편집

즉, 이미지 파일을 ‘처리한다(가공한다)’는 건 sharp의 영역이다.
multer는 그걸 못 한다.

_실무에서는 sharp가 거의 필수인 이유_

1.  `업로드된 이미지가 보통 “너무 크다”`
    스마트폰 사진 5MB~10MB는 기본이다.
    웹에서 10MB 사진을 띄우면?
    응답 지연, 모바일 데이터 폭발, 사용자가 페이지 로딩 기다리다 나감, 서버 트래픽 요금 증가
    그래서 운영 서비스는 업로드 → 리사이즈/압축이 기본이다. 이걸 multer는 못 한다.

2.  `웹 최적화를 위해서 WebP 같은 포맷으로 변환해야 함`
    jpg/png 그대로 쓰면 용량이 너무 크다.
    webp, avif 등으로 바꾸면,
    용량 80% 감소, 로딩 속도 체감 2~3배 상승
    multer는 포맷 변환을 못 한다. sharp는 1줄로 된다.

    ```js
    sharp(buffer).webp({ quality: 80 });
    ```

3.  `썸네일 생성은 필수 기능이다`
    게시판/상품사이트/커뮤니티는 이미지 원본 + 썸네일 2개를 함께 저장한다.
    thumbnail(300px), original(1200px)
    이게 UX도 좋고, 성능도 좋다.
    multer는 썸네일 생성이 안 된다. sharp는 핵심 기능!

4.  `메타데이터 제거는 보안·용량 절감에 필수`
    스마트폰 사진에는 EXIF 위치 정보가 들어 있다.
    이거 그대로 노출되면?
    사용자의 위치 정보 유출, 사진 찍은 장소 유출 가능, 보안 이슈 등
    sharp는 withMetadata(false)로 제거 가능하다. multer는 절대 못 한다.

5.  `S3 업로드 전에 용량 줄이지 않으면 비용 폭발`
    AWS S3 저장비 + 트래픽 비용 이미지 최적화 안 하면 그대로 요금 올라간다.
    sharp로 미리 압축하면 비용 큰 차이가 난다.

_결론_
multer는 “입구”, sharp는 “정제”
multer → 파일을 받고 저장하고 확장자/크기 체크
sharp → 이미지 축소/압축/변환/썸네일 생성
둘은 절대 대체 관계가 아니다. 오히려 함께 쓰라고 만든 조합이다.
